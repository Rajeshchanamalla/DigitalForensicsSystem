<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload Evidence - Digital Forensics</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <h3>ðŸ”’ Digital Forensic System</h3>
      <div class="nav-links">
        <a href="investigator-dashboard.html">Dashboard</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="page-header">
      <h1>ðŸ“¤ Upload Digital Evidence</h1>
      <p class="subtitle">Upload evidence files and store their hash securely</p>
    </div>

    <div class="upload-form">
      <div class="form-group">
        <label for="caseId">Case ID *</label>
        <input type="text" id="caseId" placeholder="Enter case ID (e.g., CASE-2024-001)" required>
        <small>Unique identifier for the forensic case</small>
      </div>

      <div class="form-group">
        <label for="fileInput">Select Evidence File(s) *</label>
        <input type="file" id="fileInput" accept="*/*" multiple required>
        <small>Select one or more digital evidence files to upload</small>
      </div>

      <div class="form-group">
        <label for="category">Category</label>
        <select id="category">
          <option value="">Select category...</option>
        </select>
      </div>

      <div class="form-group">
        <label for="tags">Tags (comma-separated)</label>
        <input type="text" id="tags" placeholder="e.g., important, photo, document">
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" rows="3" placeholder="Optional description of the evidence"></textarea>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="encryptFile"> Encrypt file before upload
        </label>
        <small style="display: block; margin-top: 5px;">Files will be encrypted with AES-256 before uploading to IPFS</small>
      </div>

      <div id="fileInfo" class="file-info" style="display: none;">
        <p><strong>File Name:</strong> <span id="fileName"></span></p>
        <p><strong>File Size:</strong> <span id="fileSize"></span></p>
      </div>

      <button onclick="uploadEvidence()" class="btn-primary btn-large">
        ðŸ”’ Upload & Store Evidence
      </button>

      <div id="uploadStatus"></div>

      <div class="results-section">
        <h3>Upload Results</h3>
        
        <div class="result-item">
          <label>SHA-256 Hash:</label>
          <div id="hashOutput" class="hash-display"></div>
        </div>

        <div class="result-item">
          <label>IPFS CID:</label>
          <div id="ipfsOutput" class="hash-display"></div>
        </div>

        <div class="result-item">
          <label>Transaction Hash:</label>
          <div id="txOutput" class="hash-display"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="env-config.js"></script>

  <script src="config.js"></script>
  <script src="evidence-api.js"></script>
  <script src="enhanced-features.js"></script>
  <script src="app.js"></script>
  <script>
    // Load categories on page load
    async function loadCategories() {
      try {
        const categories = await EnhancedFeatures.getCategories();
        const categorySelect = document.getElementById('category');
        categories.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat.name;
          option.textContent = cat.name;
          categorySelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error loading categories:', error);
      }
    }

    // Display file info when files are selected
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const files = e.target.files;
      const fileInfo = document.getElementById('fileInfo');
      
      if (files && files.length > 0) {
        fileInfo.style.display = 'block';
        if (files.length === 1) {
          document.getElementById('fileName').textContent = files[0].name;
          document.getElementById('fileSize').textContent = formatFileSize(files[0].size);
        } else {
          let totalSize = 0;
          Array.from(files).forEach(file => totalSize += file.size);
          document.getElementById('fileName').textContent = `${files.length} files selected`;
          document.getElementById('fileSize').textContent = formatFileSize(totalSize);
        }
      } else {
        fileInfo.style.display = 'none';
      }
    });

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // Load categories on page load
    document.addEventListener('DOMContentLoaded', loadCategories);
  </script>
</body>
</html>
